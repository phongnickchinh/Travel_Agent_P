# Travel Agent P - Architecture Diagram

```
┌────────────────────────────────────────────────────────────────────────────────┐
│                         TRAVEL AGENT P - MVP ARCHITECTURE                       │
└────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  CLIENT LAYER                                                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                   │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                      │
│  │  React Web   │    │  Mobile App  │    │  Admin Panel │                      │
│  │  (Vite)      │    │  (Future)    │    │  (React)     │                      │
│  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘                      │
│         │                   │                    │                               │
│         └───────────────────┴────────────────────┘                               │
│                             │                                                     │
│                    HTTPS / REST API                                              │
│                             │                                                     │
└─────────────────────────────┼─────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────┼─────────────────────────────────────────────────────┐
│  API GATEWAY LAYER          │                                                     │
├─────────────────────────────┼─────────────────────────────────────────────────────┤
│                             ▼                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Flask API Server (Port 5000)                                            │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Middleware Layer                                                 │   │   │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │   │   │
│  │  │  │  Auth (JWT)  │  │ Rate Limiter │  │     CORS     │          │   │   │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘          │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                           │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Controller Layer                                                 │   │   │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │   │   │
│  │  │  │   Auth   │  │   POI    │  │ Itinerary│  │   User   │        │   │   │
│  │  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                           │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Service Layer (Business Logic)                                  │   │   │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │   │   │
│  │  │  │AuthSvc   │  │ POISvc   │  │ItinSvc   │  │ UserSvc  │        │   │   │
│  │  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                           │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Repository Layer (Data Access)                                  │   │   │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │   │   │
│  │  │  │  PG Repo │  │MongoRepo │  │RedisRepo │  │   ES     │        │   │   │
│  │  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                              │
                              │
┌─────────────────────────────┼─────────────────────────────────────────────────────┐
│  DATA LAYER                 │                                                     │
├─────────────────────────────┼─────────────────────────────────────────────────────┤
│                             ▼                                                     │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐             │
│  │  PostgreSQL      │  │  MongoDB         │  │  Redis           │             │
│  │  (Port 5432)     │  │  (Port 27017)    │  │  (Port 6379)     │             │
│  │                  │  │                  │  │                  │             │
│  │  ┌────────────┐  │  │  ┌────────────┐ │  │  ┌────────────┐  │             │
│  │  │   users    │  │  │  │    poi     │ │  │  │ blacklist  │  │             │
│  │  │   roles    │  │  │  │itineraries │ │  │  │rate_limit │  │             │
│  │  │   tokens   │  │  │  │  reviews   │ │  │  │   cache    │  │             │
│  │  │  bookings  │  │  │  │            │ │  │  │  session   │  │             │
│  │  └────────────┘  │  │  └────────────┘ │  │  └────────────┘  │             │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘             │
│                                                                                   │
│  ┌──────────────────┐  ┌──────────────────┐                                    │
│  │  Elasticsearch   │  │  Firebase        │                                    │
│  │  (Port 9200)     │  │  Storage         │                                    │
│  │  [Optional]      │  │                  │                                    │
│  │                  │  │  ┌────────────┐  │                                    │
│  │  ┌────────────┐  │  │  │  images    │  │                                    │
│  │  │ poi_index  │  │  │  │  avatars   │  │                                    │
│  │  └────────────┘  │  │  └────────────┘  │                                    │
│  └──────────────────┘  └──────────────────┘                                    │
└─────────────────────────────────────────────────────────────────────────────────┘
                              │
                              │
┌─────────────────────────────┼─────────────────────────────────────────────────────┐
│  ASYNC PROCESSING LAYER     │                                                     │
├─────────────────────────────┼─────────────────────────────────────────────────────┤
│                             ▼                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  Celery Workers (Background Tasks)                                       │   │
│  │                                                                           │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │   │
│  │  │ Email Worker │  │   AI Worker  │  │ Sync Worker  │                  │   │
│  │  │              │  │              │  │              │                  │   │
│  │  │ • Send email │  │ • Generate   │  │ • MongoDB→ES │                  │   │
│  │  │ • Verify     │  │   itinerary  │  │ • Update     │                  │   │
│  │  │ • Reset pwd  │  │ • Embeddings │  │   cache      │                  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                  │   │
│  │                                                                           │   │
│  │  Message Broker: Redis (Celery Queue)                                    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                              │
                              │
┌─────────────────────────────┼─────────────────────────────────────────────────────┐
│  AI / ML LAYER              │                                                     │
├─────────────────────────────┼─────────────────────────────────────────────────────┤
│                             ▼                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  LangChain Framework                                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Prompt Engineering                                               │   │   │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │   │   │
│  │  │  │  Itinerary   │  │     POI      │  │  Chatbot     │          │   │   │
│  │  │  │   Prompts    │  │  Recommender │  │   Prompts    │          │   │   │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘          │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                           │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  LLM Providers                                                    │   │   │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │   │   │
│  │  │  │ HuggingFace  │  │   OpenAI     │  │   Gemini     │          │   │   │
│  │  │  │  Inference   │  │   GPT-4      │  │   (Google)   │          │   │   │
│  │  │  │     API      │  │  [Optional]  │  │  [Optional]  │          │   │   │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘          │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                           │   │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Embeddings                                                       │   │   │
│  │  │  ┌──────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │  sentence-transformers/all-MiniLM-L6-v2                  │   │   │   │
│  │  │  │  • 384-dim vectors                                        │   │   │   │
│  │  │  │  • POI semantic search                                    │   │   │   │
│  │  │  │  • Similarity matching                                    │   │   │   │
│  │  │  └──────────────────────────────────────────────────────────┘   │   │   │
│  │  └──────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  EXTERNAL SERVICES                                                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ Google OAuth │  │  Gmail SMTP  │  │ Google Places│  │  TripAdvisor │       │
│  │              │  │              │  │      API     │  │     API      │       │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘       │
│                                                                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  DATA FLOW EXAMPLES                                                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                   │
│  1. USER REGISTRATION:                                                           │
│     Client → Flask → AuthService → PostgreSQL (user)                            │
│                   → Celery (email task) → Redis Queue → Worker → Gmail          │
│                                                                                   │
│  2. USER LOGIN:                                                                  │
│     Client → Flask → Rate Limiter (Redis) → AuthService → PostgreSQL (verify)   │
│                                           → JWT tokens → Client                  │
│                                                                                   │
│  3. SEARCH POI:                                                                  │
│     Client → Flask → Cache Check (Redis) → POI Service                          │
│                                          → MongoDB (geo query)                   │
│                                          → Cache Result (Redis)                  │
│                                          → Client                                │
│                                                                                   │
│  4. GENERATE ITINERARY:                                                          │
│     Client → Flask → Celery (AI task) → Redis Queue → AI Worker                │
│                                                     → LangChain                  │
│                                                     → HuggingFace                │
│                                                     → MongoDB (POI query)        │
│                                                     → MongoDB (save itinerary)   │
│                                       → Client (job_id)                          │
│     Client → Flask (poll status) → MongoDB → Client (itinerary)                 │
│                                                                                   │
│  5. LOGOUT:                                                                      │
│     Client → Flask → AuthService → PostgreSQL (delete refresh token)            │
│                                 → Redis (blacklist access token)                 │
│                                                                                   │
└─────────────────────────────────────────────────────────────────────────────────┘
```
